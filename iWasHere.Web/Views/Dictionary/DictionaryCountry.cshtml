@model IEnumerable<iWasHere.Domain.Model.DictionaryCountry>

@{
    ViewData["Title"] = "Countries";
}

<h1>Countries</h1>

<script type="text/javascript">

    function test() {

        $("#grid").data("kendoGrid").dataSource.read();
        $("#grid").data("kendoGrid").dataSource.page(1);
    }


    function filter() {
        var CountryName = $("#CountryName").val();
        var CountryCode = $("#CountryCode").val();
        var filter = {};
        filter["CountryName"] = CountryName;
        filter["CountryCode"] = CountryCode;
        console.log(filter.CountryName);
        return filter;
    }

    function txtFilterCountry() {

        var object = {};
        object["CountryName"] = $("#CountryName").val();
        object["CountryCode"] = $("#CountryCode").val();
        return object;
    }


    function addCountry() {

        window.location.href = "@Url.Action("Country", "Dictionary")?CountryId=" + null;
    }

    @*function editCountry() {

        var gview = $("#grid").data("kendoGrid");
        var selectedItem = gview.dataItem(gview.select());
        var id = selectedItem.id;
        window.location.href = "@Url.Action("Country", "Dictionary")?CountryId=" + id;
    }*@

   function deleteFilter() {

        $("#CountryCode").val('');
        $("#CountryName").val('');
        $("#grid").data("kendoGrid").dataSource.read();
        $("#grid").data("kendoGrid").dataSource.page(1);
    }

    function editCountry(e) {

        grid = $("#grid").data("kendoGrid");
        var row = e.currentTarget.closest("tr").cells[0].outerText;
        window.location.href = "@Url.Action("Country", "Dictionary")?CountryId=" + row;
        }

        function deleteCountry(e) {

        if (confirm("Are you sure you want to delete the selected record(s)?")) {
            $.ajax({
                type: "Post",
                url: '@Url.Action("DeleteCountry", "Dictionary")',
                data: {
                   CountryId: e
                }
            })
                .done(function (e) {
                     $("#grid").data("kendoGrid").dataSource.read();
                     $("#grid").data("kendoGrid").dataSource.page(1);
                    
                })
                .fail(function (e) {
                    alert("There are other connections to County");                  
                });
        } else {
            // cancel button is clicked
        }
    }
</script>
<button id="AddCountry" onclick="addCountry()" style="display: inline-block;
    font-weight: 400;
    border-style: solid !important;
    border-color: #ced4da!important;
    color: #212529;
    text-align: center;
    vertical-align: middle;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    background-color: transparent;
    border: 1px solid transparent;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    line-height: 1.5;
    border-radius: 0.25rem;
    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;">
    Add
</button>
<br />
<br />

<label>Country Code </label>
<input id="CountryCode" type="text" style="display: block;
    width: 200px;
    height: calc(1.5em + 0.75rem + 2px);
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" />
<br />
<label>Country Name </label>
<input id="CountryName" type="text" style="display: block;
    width: 200px;
    height: calc(1.5em + 0.75rem + 2px);
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" />

<br />

<button id="FilterCountry" onclick="test()" style="display: inline-block;
    font-weight: 400;
    border-style: solid !important;
    border-color: #ced4da!important;
    color: #212529;
    text-align: center;
    vertical-align: middle;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    background-color: transparent;
    border: 1px solid transparent;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    line-height: 1.5;
    border-radius: 0.25rem;
    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;">
    Filtreaza
</button>

<button id="deleteFilterCountry" onclick="deleteFilter()" style="display: inline-block;
    font-weight: 400;
    border-style: solid !important;
    border-color: #ced4da!important;
    color: #212529;
    text-align: center;
    vertical-align: middle;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    background-color: transparent;
    border: 1px solid transparent;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    line-height: 1.5;
    border-radius: 0.25rem;
    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;">
    Clear Filters
</button>
<br />
<br />
<br />

@(Html.Kendo().Grid<iWasHere.Domain.Model.DictionaryCountry>()
    .Name("grid")
    .Columns(columns =>
    {
        columns.Bound(c => c.DictionaryCountryId).Width(70).Hidden(true);
        columns.Bound(c => c.DictionaryCountryCode).Width(70);
        columns.Bound(c => c.DictionaryCountryName).Width(110);
        columns.Command(command => { command.Custom("Edit").Click("editCountry"); command.Destroy(); }).Width(70);
    })
    .HtmlAttributes(new { style = "height: 550px;" })
    .Scrollable()
    .Groupable(false)
    .Selectable()
    .Sortable()
    .Pageable(pageable => pageable
        .Refresh(true)
        .PageSizes(true)
        .ButtonCount(5))
    .DataSource(dataSource => dataSource
        .Ajax()
        .Model(model =>
        {
            model.Id(c => c.DictionaryCountryId);
        }
        )
        .Read(read => read.Action("DictionaryCountryData", "Dictionary").Data("txtFilterCountry"))
        .Destroy(update => update.Action("DeleteCountry", "Dictionary"))
        .PageSize(20)
    )
)
