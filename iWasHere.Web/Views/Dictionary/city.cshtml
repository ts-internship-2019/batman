@model iWasHere.Domain.DTOs.DictionaryCityModel;

@{
    ViewData["Title"] = "AddCity";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h4>Add City</h4>

<body onload="onLoadEdit()">
    <ul style="list-style-type:none">
        <li>
            <label>City Name</label>
            @(Html.Kendo().TextBoxFor(model => model.Name)
                                .HtmlAttributes(new { @id = "CityName", style = "margin:10px" })
            )
            <label>City Code</label>
            @(Html.Kendo().TextBoxFor(model => model.Code)
                .HtmlAttributes(new { @id = "CityCode", style = "margin:10px" })
            )
            @(Html.Kendo().TextBoxFor(model => model.Id)
                .HtmlAttributes(new { @id = "CityId", style = "margin:10px" })
            )
        </li>

        <li>
            <label>County</label>
        </li>
        <li>
            @(Html.Kendo().ComboBoxFor(model => model.CountyId)
           //.Name("Judete")
           .DataTextField("CountyName")
           .DataValueField("CountyId")
           .HtmlAttributes(new { style = "width:150px; font-size:small; display:none id='Judete'" })
           .Filter("StartsWith")
           .DataSource(source =>
           {
               source.Read(read =>
               {
                   read.Action("ServerFiltering_GetCounties", "Dictionary");

               })
               .ServerFiltering(true);
           })
            )
        </li>

    </ul>

    <div>
        @if (Model.Id == 0)
        {
            @(Html.Kendo().Button()
          .Name("primaryTextButton")
          .HtmlAttributes(new { type = "button", @class = "k-primary" })
          .Content("Save")
          .Events(ev => ev.Click("add"))
          )

           @(Html.Kendo().Button()
                  .Name("addNewButton")
                  .HtmlAttributes(new { type = "button", @class = "k-primary" })
                  .Content("Save and new")
                  .Events(ev => ev.Click("addNew"))
            )

            <script type="text/javascript">
                 function add() {
                             $.ajax({
                                    type: 'POST',
                                    url: '@Url.Action("SaveCity", "Dictionary")',
                                    data: {
                                         cityName: document.getElementById("CityName").value,
                                         cityCode: document.getElementById("CityCode").value,
                                         countyId: document.getElementById("Judete").value
                                          },
                                    success: function (response) {
                                        window.location.href = '@Url.Action("Cities", "Dictionary")';
                                        alert("Oras inserat");
                                    },
                                    error: function (response) {
                                                        alert("Nu se poate insera acest nume de oras sau de cod");
                                            }
                            })
                 }
                function addNew() {
                                 $.ajax({
                                        type: 'POST',
                                        url: '@Url.Action("SaveCity", "Dictionary")',
                                        data: {
                                             cityName: document.getElementById("CityName").value,
                                             cityCode: document.getElementById("CityCode").value,
                                             countyId: document.getElementById("Judete").value
                                              },
                                     success: function (response) {
                                         document.getElementById("CityName").value = "";
                                         document.getElementById("CityCode").value = "";
                                         $("#Judete").val("").data("kendoComboBox").text("");
                                         alert("Orasul a fost inserat");
                                     },
                                        error: function (response) {
                                                            alert("Nu se poate insera acest nume de oras sau de cod");
                                         }
                                })
                }
            </script>
            @(Html.Kendo().Button()
              .Name("cancelButton")
              .HtmlAttributes(new { type = "button", @class = "k-primary" })
              .Content("Cancel")
              .Events(ev => ev.Click("cancelAdd"))
            )
        }



        @if(Model.Id != 0)
        {
            @(Html.Kendo().Button()
          .Name("primaryTextButton")
          .HtmlAttributes(new { type = "button", @class = "k-primary" })
          .Content("Save")
          .Events(ev => ev.Click("edit"))
            )

            <script type="text/javascript">

                function edit() {
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Action("EditCity", "Dictionary")',
                        data: {
                            cityName: document.getElementById("CityName").value,
                            cityId: document.getElementById("CityId").value,
                            cityCode: document.getElementById("CityCode").value,
                            countyId: document.getElementById("Judete").value
                        },
                        success: function (response) {
                             alert("Oras modificat");
                            window.location.href = '@Url.Action("Cities", "Dictionary")';
                        },
                        error: function (response) {
                            alert("Nu se poate modifica acest oras in acest fel!");
                        }
                    })
                }
            </script>

            @(Html.Kendo().Button()
              .Name("cancelButton")
              .HtmlAttributes(new { type = "button", @class = "k-primary" })
              .Content("Cancel")
              .Events(ev => ev.Click("cancelAdd"))
            )
        }
    </div>
</body>

<script>
        function onLoadEdit() {
            var url_string = window.location.href;
            var url = new URL(url_string);
            document.getElementById("CityId").style.visibility = "hidden";
            var id = url.searchParams.get("id");
            if (id != 0) {
                document.getElementById("primaryTextButton").innerText = "Update";
            }
        }

         function cancelAdd() {
                     window.location.href = '@Url.Action("Cities", "Dictionary")';
         }
</script>
